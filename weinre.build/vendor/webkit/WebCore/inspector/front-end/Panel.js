/*
 * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
WebInspector.Panel=function(e){WebInspector.View.call(this),this.element.addStyleClass("panel"),this.element.addStyleClass(e),this._panelName=e,WebInspector.settings.installApplicationSetting(this._sidebarWidthSettingName(),void 0)}
// Should by in sync with style declarations.
,WebInspector.Panel.counterRightMargin=25,WebInspector.Panel.prototype={get toolbarItem(){if(this._toolbarItem)return this._toolbarItem;
// Sample toolbar item as markup:
// <button class="toolbar-item resources toggleable">
// <div class="toolbar-icon"></div>
// <div class="toolbar-label">Resources</div>
// </button>
this._toolbarItem=document.createElement("button"),this._toolbarItem.className="toolbar-item toggleable",(this._toolbarItem.panel=this)._toolbarItem.addStyleClass(this._panelName);var e=document.createElement("div");if(e.className="toolbar-icon",this._toolbarItem.appendChild(e),"toolbarItemLabel"in this){var t=document.createElement("div");t.className="toolbar-label",t.textContent=this.toolbarItemLabel,this._toolbarItem.appendChild(t)}return this._toolbarItem},get name(){return this._panelName},show:function(){WebInspector.View.prototype.show.call(this);var e=this.statusBarItems;if(e){this._statusBarItemContainer=document.createElement("div");for(var t=0;t<e.length;++t)this._statusBarItemContainer.appendChild(e[t]);document.getElementById("main-status-bar").appendChild(this._statusBarItemContainer)}"_toolbarItem"in this&&this._toolbarItem.addStyleClass("toggled-on"),WebInspector.currentFocusElement=this.defaultFocusedElement,this.restoreSidebarWidth(),this._restoreScrollPositions()},hide:function(){this._storeScrollPositions(),WebInspector.View.prototype.hide.call(this),this._statusBarItemContainer&&this._statusBarItemContainer.parentNode&&this._statusBarItemContainer.parentNode.removeChild(this._statusBarItemContainer),delete this._statusBarItemContainer,"_toolbarItem"in this&&this._toolbarItem.removeStyleClass("toggled-on")},get defaultFocusedElement(){return this.sidebarTreeElement||this.element},attach:function(){this.element.parentNode||document.getElementById("main-panels").appendChild(this.element)},searchCanceled:function(){if(this._searchResults)for(var e=0;e<this._searchResults.length;++e){var t=this._searchResults[e];t.searchCanceled&&t.searchCanceled(),delete t.currentQuery}WebInspector.updateSearchMatchesCount(0,this),this._currentSearchChunkIntervalIdentifier&&(clearInterval(this._currentSearchChunkIntervalIdentifier),delete this._currentSearchChunkIntervalIdentifier),this._totalSearchMatches=0,this._currentSearchResultIndex=0,this._searchResults=[]},performSearch:function(t){
// Call searchCanceled since it will reset everything we need before doing a new search.
this.searchCanceled(!0);var s=this.searchableViews;if(s&&s.length){var i=this.viewsContainerElement,r=this.visibleView,n=this.searchResultsSortFunction,e=null,a=0,h=this,l=function(e,t){t&&(this._totalSearchMatches+=t,this._searchResults.push(e),n&&this._searchResults.sort(n),this.searchMatchFound&&this.searchMatchFound(e,t),c.call(this),e===r&&e.jumpToFirstSearchResult())}.bind(this),o=null;d(),o=setInterval(d,25),this._currentSearchChunkIntervalIdentifier=o}function c(){e||(
// Update the matches count every half-second so it doesn't feel twitchy.
e=setTimeout(function(){WebInspector.updateSearchMatchesCount(this._totalSearchMatches,this),e=null}.bind(this),500))}
// Split up the work into chunks so we don't block the
// UI thread while processing.
function d(){var e=s[a];++a>=s.length&&(h._currentSearchChunkIntervalIdentifier===o&&delete h._currentSearchChunkIntervalIdentifier,clearInterval(o)),e&&(e.element.parentNode!==i&&e.element.parentNode&&i&&e.detach(),e.currentQuery=t,e.performSearch(t,l))}},jumpToNextSearchResult:function(){if(this.showView&&this._searchResults&&this._searchResults.length){var e=!1;this._currentSearchResultIndex=this._searchResults.indexOf(this.visibleView),-1===this._currentSearchResultIndex&&(e=!(this._currentSearchResultIndex=0));var t=this._searchResults[this._currentSearchResultIndex];t.showingLastSearchResult()&&(++this._currentSearchResultIndex>=this._searchResults.length&&(this._currentSearchResultIndex=0),t=this._searchResults[this._currentSearchResultIndex],e=!0),t!==this.visibleView&&(this.showView(t),WebInspector.focusSearchField()),e?t.jumpToFirstSearchResult():t.jumpToNextSearchResult()}},jumpToPreviousSearchResult:function(){if(this.showView&&this._searchResults&&this._searchResults.length){var e=!1;this._currentSearchResultIndex=this._searchResults.indexOf(this.visibleView),-1===this._currentSearchResultIndex&&(e=!(this._currentSearchResultIndex=0));var t=this._searchResults[this._currentSearchResultIndex];t.showingFirstSearchResult()&&(--this._currentSearchResultIndex<0&&(this._currentSearchResultIndex=this._searchResults.length-1),t=this._searchResults[this._currentSearchResultIndex],e=!0),t!==this.visibleView&&(this.showView(t),WebInspector.focusSearchField()),e?t.jumpToLastSearchResult():t.jumpToPreviousSearchResult()}},createSidebar:function(e,t){this.sidebarElement||(e||(e=this.element),t||(t=e),this.sidebarElement=document.createElement("div"),this.sidebarElement.className="sidebar",e.appendChild(this.sidebarElement),this.sidebarResizeElement=document.createElement("div"),this.sidebarResizeElement.className="sidebar-resizer-vertical",this.sidebarResizeElement.addEventListener("mousedown",this._startSidebarDragging.bind(this),!1),t.appendChild(this.sidebarResizeElement),this.sidebarTreeElement=document.createElement("ol"),this.sidebarTreeElement.className="sidebar-tree",this.sidebarElement.appendChild(this.sidebarTreeElement),this.sidebarTree=new TreeOutline(this.sidebarTreeElement),this.sidebarTree.panel=this)},_sidebarWidthSettingName:function(){return this._panelName+"SidebarWidth"},_startSidebarDragging:function(e){WebInspector.elementDragStart(this.sidebarResizeElement,this._sidebarDragging.bind(this),this._endSidebarDragging.bind(this),e,"col-resize")},_sidebarDragging:function(e){this.updateSidebarWidth(e.pageX),e.preventDefault()},_endSidebarDragging:function(e){WebInspector.elementDragEnd(e),this.saveSidebarWidth()},updateSidebarWidth:function(e){this.sidebarElement&&(this.sidebarElement.offsetWidth<=0||("_currentSidebarWidth"in this||(this._currentSidebarWidth=this.sidebarElement.offsetWidth),void 0===e&&(e=this._currentSidebarWidth),e=Number.constrain(e,Preferences.minSidebarWidth,window.innerWidth/2),this._currentSidebarWidth=e,this.setSidebarWidth(e),this.updateMainViewWidth(e)))},setSidebarWidth:function(e){this.sidebarElement.style.width=e+"px",this.sidebarResizeElement.style.left=e-3+"px"},restoreSidebarWidth:function(){var e=WebInspector.settings[this._sidebarWidthSettingName()];this.updateSidebarWidth(e)},saveSidebarWidth:function(){this.sidebarElement&&(WebInspector.settings[this._sidebarWidthSettingName()]=this.sidebarElement.offsetWidth)},updateMainViewWidth:function(e){
// Should be implemented by ancestors.
},resize:function(){var e=this.visibleView;e&&"resize"in e&&e.resize()},canShowSourceLine:function(e,t){return!1},showSourceLine:function(e,t){return!1},elementsToRestoreScrollPositionsFor:function(){return[]},_storeScrollPositions:function(){for(var e=this.elementsToRestoreScrollPositionsFor(),t=0;t<e.length;++t){var s=e[t];s._scrollTop=s.scrollTop}},_restoreScrollPositions:function(){for(var e=this.elementsToRestoreScrollPositionsFor(),t=0;t<e.length;++t){var s=e[t];s._scrollTop&&(s.scrollTop=s._scrollTop)}}},WebInspector.Panel.prototype.__proto__=WebInspector.View.prototype;