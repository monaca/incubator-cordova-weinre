/*
 * Copyright (C) 2008 Apple Inc. All Rights Reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
WebInspector.ScriptsPanel=function(){for(var e in WebInspector.Panel.call(this,"scripts"),this.topStatusBar=document.createElement("div"),this.topStatusBar.className="status-bar",this.topStatusBar.id="scripts-status-bar",this.element.appendChild(this.topStatusBar),this.backButton=document.createElement("button"),this.backButton.className="status-bar-item",this.backButton.id="scripts-back",this.backButton.title=WebInspector.UIString("Show the previous script resource."),this.backButton.disabled=!0,this.backButton.appendChild(document.createElement("img")),this.backButton.addEventListener("click",this._goBack.bind(this),!1),this.topStatusBar.appendChild(this.backButton),this.forwardButton=document.createElement("button"),this.forwardButton.className="status-bar-item",this.forwardButton.id="scripts-forward",this.forwardButton.title=WebInspector.UIString("Show the next script resource."),this.forwardButton.disabled=!0,this.forwardButton.appendChild(document.createElement("img")),this.forwardButton.addEventListener("click",this._goForward.bind(this),!1),this.topStatusBar.appendChild(this.forwardButton),this.filesSelectElement=document.createElement("select"),this.filesSelectElement.className="status-bar-item",this.filesSelectElement.id="scripts-files",this.filesSelectElement.addEventListener("change",this._changeVisibleFile.bind(this),!1),this.topStatusBar.appendChild(this.filesSelectElement),this.functionsSelectElement=document.createElement("select"),this.functionsSelectElement.className="status-bar-item",this.functionsSelectElement.id="scripts-functions",
// FIXME: append the functions select element to the top status bar when it is implemented.
// this.topStatusBar.appendChild(this.functionsSelectElement);
this.formatButton=document.createElement("button"),this.formatButton.className="status-bar-item",this.formatButton.id="format-script",this.formatButton.title=WebInspector.UIString("Format script."),this.formatButton.appendChild(document.createElement("img")),this.formatButton.addEventListener("click",this._formatScript.bind(this),!1),Preferences.debugMode&&this.topStatusBar.appendChild(this.formatButton),this.sidebarButtonsElement=document.createElement("div"),this.sidebarButtonsElement.id="scripts-sidebar-buttons",this.topStatusBar.appendChild(this.sidebarButtonsElement),this.pauseButton=document.createElement("button"),this.pauseButton.className="status-bar-item",this.pauseButton.id="scripts-pause",this.pauseButton.title=WebInspector.UIString("Pause script execution."),this.pauseButton.disabled=!0,this.pauseButton.appendChild(document.createElement("img")),this.pauseButton.addEventListener("click",this._togglePause.bind(this),!1),this.sidebarButtonsElement.appendChild(this.pauseButton),this.stepOverButton=document.createElement("button"),this.stepOverButton.className="status-bar-item",this.stepOverButton.id="scripts-step-over",this.stepOverButton.title=WebInspector.UIString("Step over next function call."),this.stepOverButton.disabled=!0,this.stepOverButton.addEventListener("click",this._stepOverClicked.bind(this),!1),this.stepOverButton.appendChild(document.createElement("img")),this.sidebarButtonsElement.appendChild(this.stepOverButton),this.stepIntoButton=document.createElement("button"),this.stepIntoButton.className="status-bar-item",this.stepIntoButton.id="scripts-step-into",this.stepIntoButton.title=WebInspector.UIString("Step into next function call."),this.stepIntoButton.disabled=!0,this.stepIntoButton.addEventListener("click",this._stepIntoClicked.bind(this),!1),this.stepIntoButton.appendChild(document.createElement("img")),this.sidebarButtonsElement.appendChild(this.stepIntoButton),this.stepOutButton=document.createElement("button"),this.stepOutButton.className="status-bar-item",this.stepOutButton.id="scripts-step-out",this.stepOutButton.title=WebInspector.UIString("Step out of current function."),this.stepOutButton.disabled=!0,this.stepOutButton.addEventListener("click",this._stepOutClicked.bind(this),!1),this.stepOutButton.appendChild(document.createElement("img")),this.sidebarButtonsElement.appendChild(this.stepOutButton),this.toggleBreakpointsButton=new WebInspector.StatusBarButton(WebInspector.UIString("Deactivate all breakpoints."),"toggle-breakpoints"),this.toggleBreakpointsButton.toggled=!0,this.toggleBreakpointsButton.addEventListener("click",this.toggleBreakpointsClicked.bind(this),!1),this.sidebarButtonsElement.appendChild(this.toggleBreakpointsButton.element),this.debuggerStatusElement=document.createElement("div"),this.debuggerStatusElement.id="scripts-debugger-status",this.sidebarButtonsElement.appendChild(this.debuggerStatusElement),this.viewsContainerElement=document.createElement("div"),this.viewsContainerElement.id="script-resource-views",this.sidebarElement=document.createElement("div"),this.sidebarElement.id="scripts-sidebar",this.sidebarResizeElement=document.createElement("div"),this.sidebarResizeElement.className="sidebar-resizer-vertical",this.sidebarResizeElement.addEventListener("mousedown",this._startSidebarResizeDrag.bind(this),!1),this.sidebarResizeWidgetElement=document.createElement("div"),this.sidebarResizeWidgetElement.id="scripts-sidebar-resizer-widget",this.sidebarResizeWidgetElement.addEventListener("mousedown",this._startSidebarResizeDrag.bind(this),!1),this.topStatusBar.appendChild(this.sidebarResizeWidgetElement),this.sidebarPanes={},this.sidebarPanes.watchExpressions=new WebInspector.WatchExpressionsSidebarPane,this.sidebarPanes.callstack=new WebInspector.CallStackSidebarPane,this.sidebarPanes.scopechain=new WebInspector.ScopeChainSidebarPane,this.sidebarPanes.jsBreakpoints=new WebInspector.JavaScriptBreakpointsSidebarPane,Preferences.nativeInstrumentationEnabled&&(this.sidebarPanes.domBreakpoints=WebInspector.createDOMBreakpointsSidebarPane(),this.sidebarPanes.xhrBreakpoints=WebInspector.createXHRBreakpointsSidebarPane(),this.sidebarPanes.eventListenerBreakpoints=new WebInspector.EventListenerBreakpointsSidebarPane),this.sidebarPanes.workers=new WebInspector.WorkersSidebarPane,this.sidebarPanes)this.sidebarElement.appendChild(this.sidebarPanes[e].element);this.sidebarPanes.callstack.expanded=!0,this.sidebarPanes.callstack.addEventListener("call frame selected",this._callFrameSelected,this),this.sidebarPanes.scopechain.expanded=!0,this.sidebarPanes.jsBreakpoints.expanded=!0;var t=WebInspector.UIString("You need to enable debugging before you can use the Scripts panel."),s=WebInspector.UIString("Enabling debugging will make scripts run slower."),i=WebInspector.UIString("Enable Debugging");this.panelEnablerView=new WebInspector.PanelEnablerView("scripts",t,s,i),this.panelEnablerView.addEventListener("enable clicked",this._enableDebugging,this),this.element.appendChild(this.panelEnablerView.element),this.element.appendChild(this.viewsContainerElement),this.element.appendChild(this.sidebarElement),this.element.appendChild(this.sidebarResizeElement),this.enableToggleButton=new WebInspector.StatusBarButton("","enable-toggle-status-bar-item"),this.enableToggleButton.addEventListener("click",this._toggleDebugging.bind(this),!1),Preferences.debuggerAlwaysEnabled&&this.enableToggleButton.element.addStyleClass("hidden"),this._pauseOnExceptionButton=new WebInspector.StatusBarButton("","scripts-pause-on-exceptions-status-bar-item",3),this._pauseOnExceptionButton.addEventListener("click",this._togglePauseOnExceptions.bind(this),!1),this._registerShortcuts(),this._debuggerEnabled=Preferences.debuggerAlwaysEnabled,this.reset(),WebInspector.debuggerModel.addEventListener(WebInspector.DebuggerModel.Events.ParsedScriptSource,this._parsedScriptSource,this),WebInspector.debuggerModel.addEventListener(WebInspector.DebuggerModel.Events.FailedToParseScriptSource,this._failedToParseScriptSource,this),WebInspector.debuggerModel.addEventListener(WebInspector.DebuggerModel.Events.ScriptSourceChanged,this._scriptSourceChanged,this),WebInspector.debuggerModel.addEventListener(WebInspector.DebuggerModel.Events.DebuggerPaused,this._debuggerPaused,this),WebInspector.debuggerModel.addEventListener(WebInspector.DebuggerModel.Events.DebuggerResumed,this._debuggerResumed,this)}
// Keep these in sync with WebCore::ScriptDebugServer
,WebInspector.ScriptsPanel.PauseOnExceptionsState={DontPauseOnExceptions:0,PauseOnAllExceptions:1,PauseOnUncaughtExceptions:2},WebInspector.ScriptsPanel.prototype={get toolbarItemLabel(){return WebInspector.UIString("Scripts")},get statusBarItems(){return[this.enableToggleButton.element,this._pauseOnExceptionButton.element]},get defaultFocusedElement(){return this.filesSelectElement},get paused(){return this._paused},show:function(){WebInspector.Panel.prototype.show.call(this),this.sidebarResizeElement.style.right=this.sidebarElement.offsetWidth-3+"px",this.visibleView&&this.visibleView.show(this.viewsContainerElement)},hide:function(){this.visibleView&&this.visibleView.hide(),WebInspector.Panel.prototype.hide.call(this)},get breakpointsActivated(){return this.toggleBreakpointsButton.toggled},_parsedScriptSource:function(e){this._addScript(e.data)},_failedToParseScriptSource:function(e){this._addScript(e.data)},_scriptSourceChanged:function(e){var t,s=e.data.sourceID,i=e.data.oldSource,r=WebInspector.debuggerModel.scriptForSourceID(s);if(r.resource){o=this._urlToSourceFrame[r.resource.url],delete this._urlToSourceFrame[r.resource.url],t=this._sourceFrameForResource(r.resource);var n=WebInspector.debuggerModel.editScriptSource.bind(WebInspector.debuggerModel,s,i);r.resource.setContent(r.source,n)}else{var o=r._sourceFrame;delete r._sourceFrame,t=this._sourceFrameForScript(r)}t.scrollTop=o.scrollTop,this.visibleView===o&&(this.visibleView=t);var a=WebInspector.debuggerModel.callFrames;a.length&&this._debuggerPaused({data:{callFrames:a}})},_addScript:function(e){var t=WebInspector.networkManager.inflightResourceForURL(e.sourceURL)||WebInspector.resourceForURL(e.sourceURL);t&&(t.finished?
// Resource is finished, bind the script right away.
e.resource=t:(
// Resource is not finished, bind the script later.
t._scriptsPendingResourceLoad||(t._scriptsPendingResourceLoad=[],t.addEventListener("finished",this._resourceLoadingFinished,this)),t._scriptsPendingResourceLoad.push(e))),this._addScriptToFilesMenu(e)},_resourceLoadingFinished:function(e){for(var t=e.target,s=!1,i=this.filesSelectElement,r=0;r<t._scriptsPendingResourceLoad.length;++r){
// Bind script to resource.
var n=t._scriptsPendingResourceLoad[r];n.resource=t,i.options[i.selectedIndex]===n.filesSelectOption&&(s=!0),
// Remove script from the files list.
n.filesSelectOption.parentElement.removeChild(n.filesSelectOption)}
// Adding first script will add resource.
this._addScriptToFilesMenu(t._scriptsPendingResourceLoad[0]),delete t._scriptsPendingResourceLoad,s&&this._showScriptOrResource(t,{initialLoad:!0})},addConsoleMessage:function(e){this._messages.push(e);var t=this._urlToSourceFrame[e.url];t&&t.addMessage(e)},clearConsoleMessages:function(){for(var e in this._messages=[],this._urlToSourceFrame)this._urlToSourceFrame[e].clearMessages()},selectedCallFrameId:function(){var e=this.sidebarPanes.callstack.selectedCallFrame;return e?e.id:null},evaluateInSelectedCallFrame:function(e,t,s,i,r){var n=this.sidebarPanes.callstack.selectedCallFrame;this._paused&&n&&(void 0===t&&(t=!0),InspectorBackend.evaluateOnCallFrame(n.id,e,s,i,function(e){e&&(r(WebInspector.RemoteObject.fromPayload(e)),t&&this.sidebarPanes.scopechain.update(n))}.bind(this)))},_debuggerPaused:function(e){var t=e.data.callFrames;this._paused=!0,this._waitingToPause=!1,this._stepping=!1,this._updateDebuggerButtons(),(WebInspector.currentPanel=this).sidebarPanes.callstack.update(e.data),this.sidebarPanes.callstack.selectedCallFrame=t[0],window.focus(),InspectorFrontendHost.bringToFront()},_debuggerResumed:function(){this._paused=!1,this._waitingToPause=!1,this._stepping=!1,this._clearInterface()},debuggerWasEnabled:function(){this._setPauseOnExceptions(WebInspector.settings.pauseOnExceptionState),this._debuggerEnabled||(this._debuggerEnabled=!0,this.reset(!0))},debuggerWasDisabled:function(){this._debuggerEnabled&&(this._debuggerEnabled=!1,this.reset(!0))},reset:function(e){this.visibleView=null,delete this.currentQuery,this.searchCanceled(),this._debuggerResumed(),this._backForwardList=[],this._currentBackForwardIndex=-1,this._updateBackAndForwardButtons(),this._urlToSourceFrame={},this._messages=[],this._resourceForURLInFilesSelect={},this.filesSelectElement.removeChildren(),this.functionsSelectElement.removeChildren(),this.viewsContainerElement.removeChildren(),this.sidebarPanes.watchExpressions.refreshExpressions(),e||this.sidebarPanes.workers.reset()},get visibleView(){return this._visibleView},set visibleView(e){this._visibleView!==e&&(this._visibleView&&this._visibleView.hide(),(this._visibleView=e)&&e.show(this.viewsContainerElement))},canShowSourceLine:function(e,t){return!!this._debuggerEnabled&&!!this._scriptOrResourceForURLAndLine(e,t)},showSourceLine:function(e,t){var s=this._scriptOrResourceForURLAndLine(e,t);this._showScriptOrResource(s,{line:t,shouldHighlightLine:!0})},_scriptOrResourceForURLAndLine:function(e,t){for(var s=WebInspector.debuggerModel.scriptsForURL(e),i=0;i<s.length;++i){var r=s[i];if(r.resource)return r.resource;if(r.startingLine<=t&&r.startingLine+r.linesCount>t)return r}return null},showView:function(e){e&&this._showScriptOrResource(e.resource||e.script)},handleShortcut:function(e){var t=WebInspector.KeyboardShortcut.makeKeyFromEvent(e),s=this._shortcuts[t];s?(s(e),e.handled=!0):this.sidebarPanes.callstack.handleShortcut(e)},_sourceFrameForScriptOrResource:function(e){return e instanceof WebInspector.Resource?this._sourceFrameForResource(e):this._sourceFrameForScript(e)},_sourceFrameForResource:function(e){var t=this._urlToSourceFrame[e.url];if(t)return t;var s=new WebInspector.SourceFrameContentProviderForResource(e),i=e.type===WebInspector.Resource.Type.Script;t=new WebInspector.SourceFrame(s,e.url,i);for(var r=0;r<this._messages.length;++r){var n=this._messages[r];this._messages[r].url===e.url&&t.addMessage(n)}return this._urlToSourceFrame[e.url]=t},_sourceFrameForScript:function(e){if(e._sourceFrame)return e._sourceFrame;var t=new WebInspector.SourceFrameContentProviderForScript(e);return e._sourceFrame=new WebInspector.SourceFrame(t,e.sourceURL,!0),e._sourceFrame},_showScriptOrResource:function(e,t){if(
// options = {line:, shouldHighlightLine:, fromBackForwardAction:, initialLoad:}
t=t||{},e){var s=this._sourceFrameForScriptOrResource(e);if(s){var i,r=e.url||e.sourceURL;if(r&&!t.initialLoad&&(WebInspector.settings.lastViewedScriptFile=r),!t.fromBackForwardAction){var n=this._currentBackForwardIndex;0<=n&&this._backForwardList.splice(n+1,this._backForwardList.length-n);
// Check for a previous entry of the same object in _backForwardList.
// If one is found, remove it and update _currentBackForwardIndex to match.
var o=this._backForwardList.indexOf(e);-1!==o&&(this._backForwardList.splice(o,1),--this._currentBackForwardIndex),this._backForwardList.push(e),++this._currentBackForwardIndex,this._updateBackAndForwardButtons()}this.visibleView=s,t.line&&(s.revealLine&&s.revealLine(t.line),s.highlightLine&&t.shouldHighlightLine&&s.highlightLine(t.line)),e instanceof WebInspector.Script?(
// hasn't been added yet - happens for stepping in evals,
// so use the force option to force the script into the menu.
(i=e.filesSelectOption)||(this._addScriptToFilesMenu(e,!0),i=e.filesSelectOption),console.assert(i)):i=e.filesSelectOption,i&&(this.filesSelectElement.selectedIndex=i.index)}}},_addScriptToFilesMenu:function(e,t){if(e.sourceURL||t){if(e.resource){if(this._resourceForURLInFilesSelect[e.resource.url])return;this._resourceForURLInFilesSelect[e.resource.url]=e.resource}var s=e.sourceURL?WebInspector.displayNameForURL(e.sourceURL):WebInspector.UIString("(program)"),i=this.filesSelectElement,r=document.createElement("option");r.representedObject=e.resource||e,r.url=s,r.startingLine=e.startingLine,r.text=e.resource||1===e.startingLine?s:String.sprintf("%s:%d",s,e.startingLine);var n=insertionIndexForObjectInListSortedByFunction(r,i.childNodes,function(e,t){return e.url<t.url?-1:e.url>t.url?1:"number"!=typeof e.startingLine?-1:"number"!=typeof t.startingLine?-1:e.startingLine-t.startingLine});if(n<0?i.appendChild(r):i.insertBefore(r,i.childNodes.item(n)),e.resource?e.resource.filesSelectOption=r:e.filesSelectOption=r,i.options[i.selectedIndex]===r)
// Call _showScriptOrResource if the option we just appended ended up being selected.
// This will happen for the first item added to the menu.
this._showScriptOrResource(r.representedObject,{initialLoad:!0});else{
// If not first item, check to see if this was the last viewed
var o=r.representedObject.url||r.representedObject.sourceURL,a=WebInspector.settings.lastViewedScriptFile;if(o&&o===a)!!!r.representedObject.url&&this.visibleView&&this.visibleView.script&&this.visibleView.script.sourceURL===o||this._showScriptOrResource(r.representedObject,{initialLoad:!0})}e.worldType===WebInspector.Script.WorldType.EXTENSIONS_WORLD&&e.filesSelectOption.addStyleClass("extension-script")}},_clearCurrentExecutionLine:function(){this._executionSourceFrame&&this._executionSourceFrame.clearExecutionLocation(),delete this._executionSourceFrame},_callFrameSelected:function(){this._clearCurrentExecutionLine();var e=this.sidebarPanes.callstack.selectedCallFrame;if(e){this.sidebarPanes.scopechain.update(e),this.sidebarPanes.watchExpressions.refreshExpressions();var t=WebInspector.debuggerModel.scriptForSourceID(e.sourceID),s=t.resource||t;this._showScriptOrResource(s,{line:e.line}),this._executionSourceFrame=this._sourceFrameForScriptOrResource(s),this._executionSourceFrame&&this._executionSourceFrame.setExecutionLocation(e.line,e.column)}},_changeVisibleFile:function(e){var t=this.filesSelectElement;this._showScriptOrResource(t.options[t.selectedIndex].representedObject)},_startSidebarResizeDrag:function(e){WebInspector.elementDragStart(this.sidebarElement,this._sidebarResizeDrag.bind(this),this._endSidebarResizeDrag.bind(this),e,"col-resize"),e.target===this.sidebarResizeWidgetElement?this._dragOffset=e.target.offsetWidth-(e.pageX-e.target.totalOffsetLeft):this._dragOffset=0},_endSidebarResizeDrag:function(e){WebInspector.elementDragEnd(e),delete this._dragOffset,this.saveSidebarWidth()},_sidebarResizeDrag:function(e){var t=e.pageX+this._dragOffset,s=Number.constrain(window.innerWidth-t,Preferences.minScriptsSidebarWidth,.66*window.innerWidth);this.setSidebarWidth(s),e.preventDefault()},setSidebarWidth:function(e){this.sidebarElement.style.width=e+"px",this.sidebarButtonsElement.style.width=e+"px",this.viewsContainerElement.style.right=e+"px",this.sidebarResizeWidgetElement.style.right=e+"px",this.sidebarResizeElement.style.right=e-3+"px",this.resize()},_setPauseOnExceptions:function(e){InspectorBackend.setPauseOnExceptionsState(e,function(e){e==WebInspector.ScriptsPanel.PauseOnExceptionsState.DontPauseOnExceptions?this._pauseOnExceptionButton.title=WebInspector.UIString("Don't pause on exceptions.\nClick to Pause on all exceptions."):e==WebInspector.ScriptsPanel.PauseOnExceptionsState.PauseOnAllExceptions?this._pauseOnExceptionButton.title=WebInspector.UIString("Pause on all exceptions.\nClick to Pause on uncaught exceptions."):e==WebInspector.ScriptsPanel.PauseOnExceptionsState.PauseOnUncaughtExceptions&&(this._pauseOnExceptionButton.title=WebInspector.UIString("Pause on uncaught exceptions.\nClick to Not pause on exceptions.")),this._pauseOnExceptionButton.state=e,WebInspector.settings.pauseOnExceptionState=e}.bind(this))},_updateDebuggerButtons:function(){this._debuggerEnabled?(this.enableToggleButton.title=WebInspector.UIString("Debugging enabled. Click to disable."),this.enableToggleButton.toggled=!0,this._pauseOnExceptionButton.visible=!0,this.panelEnablerView.visible=!1):(this.enableToggleButton.title=WebInspector.UIString("Debugging disabled. Click to enable."),this.enableToggleButton.toggled=!1,this._pauseOnExceptionButton.visible=!1,this.panelEnablerView.visible=!0),this._paused?(this.pauseButton.addStyleClass("paused"),this.pauseButton.disabled=!1,this.stepOverButton.disabled=!1,this.stepIntoButton.disabled=!1,this.stepOutButton.disabled=!1,this.debuggerStatusElement.textContent=WebInspector.UIString("Paused")):(this.pauseButton.removeStyleClass("paused"),this.pauseButton.disabled=this._waitingToPause,this.stepOverButton.disabled=!0,this.stepIntoButton.disabled=!0,this.stepOutButton.disabled=!0,this._waitingToPause?this.debuggerStatusElement.textContent=WebInspector.UIString("Pausing"):this._stepping?this.debuggerStatusElement.textContent=WebInspector.UIString("Stepping"):this.debuggerStatusElement.textContent="")},_updateBackAndForwardButtons:function(){this.backButton.disabled=this._currentBackForwardIndex<=0,this.forwardButton.disabled=this._currentBackForwardIndex>=this._backForwardList.length-1},_clearInterface:function(){this.sidebarPanes.callstack.update(null),this.sidebarPanes.scopechain.update(null),this._clearCurrentExecutionLine(),this._updateDebuggerButtons()},_goBack:function(){this._currentBackForwardIndex<=0?console.error("Can't go back from index "+this._currentBackForwardIndex):(this._showScriptOrResource(this._backForwardList[--this._currentBackForwardIndex],{fromBackForwardAction:!0}),this._updateBackAndForwardButtons())},_goForward:function(){this._currentBackForwardIndex>=this._backForwardList.length-1?console.error("Can't go forward from index "+this._currentBackForwardIndex):(this._showScriptOrResource(this._backForwardList[++this._currentBackForwardIndex],{fromBackForwardAction:!0}),this._updateBackAndForwardButtons())},_formatScript:function(){this.visibleView&&this.visibleView.formatSource()},_enableDebugging:function(){this._debuggerEnabled||this._toggleDebugging(this.panelEnablerView.alwaysEnabled)},_toggleDebugging:function(e){this._paused=!1,this._waitingToPause=!1,this._stepping=!1,this._debuggerEnabled?(WebInspector.settings.debuggerEnabled=!1,WebInspector.debuggerModel.disableDebugger()):(WebInspector.settings.debuggerEnabled=!!e,WebInspector.debuggerModel.enableDebugger())},_togglePauseOnExceptions:function(){this._setPauseOnExceptions((this._pauseOnExceptionButton.state+1)%this._pauseOnExceptionButton.states)},_togglePause:function(){this._paused?(this._paused=!1,this._waitingToPause=!1,InspectorBackend.resume()):(this._stepping=!1,this._waitingToPause=!0,InspectorBackend.pause()),this._clearInterface()},_stepOverClicked:function(){this._paused=!1,this._stepping=!0,this._clearInterface(),InspectorBackend.stepOver()},_stepIntoClicked:function(){this._paused=!1,this._stepping=!0,this._clearInterface(),InspectorBackend.stepInto()},_stepOutClicked:function(){this._paused=!1,this._stepping=!0,this._clearInterface(),InspectorBackend.stepOut()},toggleBreakpointsClicked:function(){this.toggleBreakpointsButton.toggled=!this.toggleBreakpointsButton.toggled,this.toggleBreakpointsButton.toggled?(InspectorBackend.activateBreakpoints(),this.toggleBreakpointsButton.title=WebInspector.UIString("Deactivate all breakpoints."),document.getElementById("main-panels").removeStyleClass("breakpoints-deactivated")):(InspectorBackend.deactivateBreakpoints(),this.toggleBreakpointsButton.title=WebInspector.UIString("Activate all breakpoints."),document.getElementById("main-panels").addStyleClass("breakpoints-deactivated"))},elementsToRestoreScrollPositionsFor:function(){return[this.sidebarElement]},_registerShortcuts:function(){var e,t,s,i=WebInspector.shortcutsHelp.section(WebInspector.UIString("Scripts Panel")),r=WebInspector.KeyboardShortcut.Modifiers.CtrlOrMeta;this._shortcuts={},
// Continue.
e=this.pauseButton.click.bind(this.pauseButton),t=WebInspector.KeyboardShortcut.makeDescriptor(WebInspector.KeyboardShortcut.Keys.F8),this._shortcuts[t.key]=e,s=WebInspector.KeyboardShortcut.makeDescriptor(WebInspector.KeyboardShortcut.Keys.Slash,r),this._shortcuts[s.key]=e,i.addAlternateKeys([t.name,s.name],WebInspector.UIString("Continue")),
// Step over.
e=this.stepOverButton.click.bind(this.stepOverButton),t=WebInspector.KeyboardShortcut.makeDescriptor(WebInspector.KeyboardShortcut.Keys.F10),this._shortcuts[t.key]=e,s=WebInspector.KeyboardShortcut.makeDescriptor(WebInspector.KeyboardShortcut.Keys.SingleQuote,r),this._shortcuts[s.key]=e,i.addAlternateKeys([t.name,s.name],WebInspector.UIString("Step over")),
// Step into.
e=this.stepIntoButton.click.bind(this.stepIntoButton),t=WebInspector.KeyboardShortcut.makeDescriptor(WebInspector.KeyboardShortcut.Keys.F11),this._shortcuts[t.key]=e,s=WebInspector.KeyboardShortcut.makeDescriptor(WebInspector.KeyboardShortcut.Keys.Semicolon,r),this._shortcuts[s.key]=e,i.addAlternateKeys([t.name,s.name],WebInspector.UIString("Step into")),
// Step out.
e=this.stepOutButton.click.bind(this.stepOutButton),t=WebInspector.KeyboardShortcut.makeDescriptor(WebInspector.KeyboardShortcut.Keys.F11,WebInspector.KeyboardShortcut.Modifiers.Shift),this._shortcuts[t.key]=e,s=WebInspector.KeyboardShortcut.makeDescriptor(WebInspector.KeyboardShortcut.Keys.Semicolon,WebInspector.KeyboardShortcut.Modifiers.Shift,r),this._shortcuts[s.key]=e,i.addAlternateKeys([t.name,s.name],WebInspector.UIString("Step out")),t=WebInspector.isMac()?WebInspector.KeyboardShortcut.makeDescriptor("l",WebInspector.KeyboardShortcut.Modifiers.Meta):WebInspector.KeyboardShortcut.makeDescriptor("g",WebInspector.KeyboardShortcut.Modifiers.Ctrl),this._shortcuts[t.key]=this.showGoToLineDialog.bind(this),i.addAlternateKeys([t.name],WebInspector.UIString("Go to Line")),this.sidebarPanes.callstack.registerShortcuts(i)},searchCanceled:function(){WebInspector.updateSearchMatchesCount(0,this),this._searchView&&this._searchView.searchCanceled(),delete this._searchView,delete this._searchQuery},performSearch:function(e){this.visibleView&&(
// Call searchCanceled since it will reset everything we need before doing a new search.
this.searchCanceled(),this._searchView=this.visibleView,this._searchQuery=e,this._searchView.performSearch(e,function(e,t){t&&(WebInspector.updateSearchMatchesCount(t,this),e.jumpToFirstSearchResult())}.bind(this)))},jumpToNextSearchResult:function(){this._searchView&&(this._searchView===this.visibleView?this._searchView.showingLastSearchResult()?this._searchView.jumpToFirstSearchResult():this._searchView.jumpToNextSearchResult():this.performSearch(this._searchQuery))},jumpToPreviousSearchResult:function(){if(this._searchView)return this._searchView!==this.visibleView?(this.performSearch(this._searchQuery),void(this._searchView&&this._searchView.jumpToLastSearchResult())):void(this._searchView.showingFirstSearchResult()?this._searchView.jumpToLastSearchResult():this._searchView.jumpToPreviousSearchResult())},showGoToLineDialog:function(e){var t=this.visibleView;t&&WebInspector.GoToLineDialog.show(t)}},WebInspector.ScriptsPanel.prototype.__proto__=WebInspector.Panel.prototype,WebInspector.SourceFrameContentProviderForScript=function(e){WebInspector.SourceFrameContentProvider.call(this),this._script=e},WebInspector.SourceFrameContentProviderForScript.prototype={requestContent:function(n){this._script.requestSource(function(e){if(e){for(var t="",s=0;s<this._script.lineOffset;++s)t+="\n";e=t+e}else e=WebInspector.UIString("<source is not available>");var i=new WebInspector.IdenticalSourceMapping,r=WebInspector.ScriptFormatter.findScriptRanges(e.lineEndings(),[this._script]);n("text/javascript",new WebInspector.SourceFrameContent(e,i,r))}.bind(this))}},WebInspector.SourceFrameContentProviderForScript.prototype.__proto__=WebInspector.SourceFrameContentProvider.prototype;