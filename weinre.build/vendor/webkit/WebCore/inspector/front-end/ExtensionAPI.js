/*
 * Copyright (C) 2010 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
WebInspector.injectedExtensionAPI=function(e,t,n){
// Here and below, all constructors are private to API implementation.
// For a public type Foo, if internal fields are present, these are on
// a private FooImpl type, an instance of FooImpl is used in a closure
// by Foo consutrctor to re-bind publicly exported members to an instance
// of Foo.
function i(e,t){this._type=e,this._listeners=[],this._customDispatch=t}function s(){this.audits=new _,this.inspectedWindow=new g,this.panels=new a,this.resources=new o,this.onReset=new I("reset")}function o(){this.onFinished=new I("resource-finished",function(e){var t=e.arguments[1];t.__proto__=new O(e.arguments[0]),this._fire(t)})}function r(e){this._id=e}function a(){var t={elements:new u};function e(e){return t[e]}for(var n in t)this.__defineGetter__(n,w(e,null,n))}function c(e){this._id=e}function d(e){c.call(this,e)}function u(){var e="elements";S.call(this,e),this.onSelectionChanged=new I("panel-objectSelected-"+e)}function l(e){A.call(this,e),this.onSearch=new I("panel-search-"+e)}function h(e){this._id=e}function p(e){h.call(this,e),this.onUpdated=new I("watch-sidebar-updated-"+e)}function f(e){var t=new p(e);C.call(this,e,t)}function _(){}function y(e){this._id=e;for(var t=["url","snippet","text"],n=0;n<t.length;++n)this[t[n]]=w(this._nodeFactory,null,t[n])}function m(e){this.contents=e,this.children=[],this.expanded=!1}function g(){this.onDOMContentLoaded=new I("inspectedPageDOMContentLoaded"),this.onLoaded=new I("inspectedPageLoaded"),this.onNavigated=new I("inspectedURLChanged")}function v(){this._callbacks={},this._handlers={},this._lastRequestId=0,this._lastObjectId=0,this.registerHandler("callback",w(this._onCallback,this));var e=new MessageChannel;this._port=e.port1,this._port.addEventListener("message",w(this._onMessage,this),!1),this._port.start(),top.postMessage("registerExtension",[e.port2],"*")}function b(e){if(!e)return e;if(/^[^/]+:/.exec(e))// See if url has schema.
return e;var t=location.protocol+"//"+location.hostname+location.port;return/^\//.exec(e)?t+e:t+location.pathname.replace(/\/[^/]*$/,"/")+e}function w(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments,0)))}}function R(t){return function(){var e={__proto__:t.prototype};t.apply(e,arguments),function(e,t){for(var n in t)if("_"!==n.charAt(0)){var i=t[n];e[n]="function"==typeof i?w(i,t):e[n]=t[n]}}(this,e)}}i.prototype={addListener:function(e){if("function"!=typeof e)throw new"addListener: callback is not a function";0===this._listeners.length&&k.sendRequest({command:"subscribe",type:this._type}),this._listeners.push(e),k.registerHandler("notify-"+this._type,w(this._dispatch,this))},removeListener:function(e){for(var t=this._listeners,n=0;n<t.length;++n)if(t[n]===e){t.splice(n,1);break}0===this._listeners.length&&k.sendRequest({command:"unsubscribe",type:this._type})},_fire:function(){for(var e=this._listeners.slice(),t=0;t<e.length;++t)e[t].apply(null,arguments)},_dispatch:function(e){this._customDispatch?this._customDispatch.call(this,e):this._fire.apply(this,e.arguments)}},s.prototype={log:function(e){k.sendRequest({command:"log",message:e})}},o.prototype={getHAR:function(i){return k.sendRequest({command:"getHAR"},i&&function(e){for(var t=e&&e.entries||[],n=0;n<t.length;++n)t[n].__proto__=new O(t[n]._resourceId),delete t[n]._resourceId;i(e)})},addRequestHeaders:function(e){return k.sendRequest({command:"addRequestHeaders",headers:e,extensionId:location.hostname})}},r.prototype={getContent:function(t){k.sendRequest({command:"getResourceContent",id:this._id},t&&function(e){t(e.content,e.encoding)})}},a.prototype={create:function(e,t,n,i){var s="extension-panel-"+k.nextObjectId(),o={command:"createPanel",id:s,title:e,icon:b(t),url:b(n)};k.sendRequest(o,i&&w(i,this,new l(s)))}},(d.prototype={createSidebarPane:function(e,t,n){var i="extension-sidebar-"+k.nextObjectId(),s={command:"createSidebarPane",panel:this._id,id:i,title:e,url:b(t)};k.sendRequest(s,n&&function(){n(new C(i))})},createWatchExpressionSidebarPane:function(e,t){var n="watch-sidebar-"+k.nextObjectId(),i={command:"createWatchExpressionSidebarPane",panel:this._id,id:n,title:e};k.sendRequest(i,t&&function(){t(new f(n))})}}).__proto__=c.prototype,h.prototype={setHeight:function(e){k.sendRequest({command:"setSidebarHeight",id:this._id,height:e})}},(p.prototype={setExpression:function(e,t){k.sendRequest({command:"setWatchSidebarContent",id:this._id,expression:e,rootTitle:t,evaluateOnPage:!0})},setObject:function(e,t){k.sendRequest({command:"setWatchSidebarContent",id:this._id,expression:e,rootTitle:t})}}).__proto__=h.prototype,_.prototype={addCategory:function(e,t){var n="extension-audit-category-"+k.nextObjectId();return k.sendRequest({command:"addAuditCategory",id:n,displayName:e,resultCount:t}),new q(n)}},y.prototype={addResult:function(e,t,n,i){
// shorthand for specifying details directly in addResult().
!i||i instanceof m||(i=i instanceof Array?this.createNode.apply(this,i):this.createNode(i));var s={command:"addAuditResult",resultId:this._id,displayName:e,description:t,severity:n,details:i};k.sendRequest(s)},createResult:function(){var e=new m;return e.contents=Array.prototype.slice.call(arguments),e},done:function(){k.sendRequest({command:"stopAuditCategoryRun",resultId:this._id})},get Severity(){return apiPrivate.audits.Severity},_nodeFactory:function(e){return{type:e,arguments:Array.prototype.slice.call(arguments,1)}}},m.prototype={addChild:function(){var e=y.prototype.createResult.apply(null,arguments);return this.children.push(e),e}},g.prototype={reload:function(e){return k.sendRequest({command:"reload",userAgent:e})},eval:function(e,n){return k.sendRequest({command:"evaluateOnInspectedPage",expression:e},n&&function(e){var t=e.value;e.isException||(t="undefined"===t?void 0:JSON.parse(t)),n(t,e.isException)})}},v.prototype={sendRequest:function(e,t){return"function"==typeof t&&(e.requestId=this._registerCallback(t)),this._port.postMessage(e)},registerHandler:function(e,t){this._handlers[e]=t},nextObjectId:function(){return n+"_"+ ++this._lastObjectId},_registerCallback:function(e){var t=++this._lastRequestId;return this._callbacks[t]=e,t},_onCallback:function(e){if(e.requestId in this._callbacks){var t=this._callbacks[e.requestId];delete this._callbacks[e.requestId],t(e.result)}},_onMessage:function(e){var t=e.data,n=this._handlers[t.command];n&&n.call(this,t)}};var q=R(function(e){this._id=e,this.onAuditStarted=new I("audit-started-"+e,function(e){var t=new x(e.arguments[0]);try{this._fire(t)}catch(e){console.error("Uncaught exception in extension audit event handler: "+e),t.done()}})}),x=R(y),I=R(i),C=R(h),A=R(c),S=R(d),O=R(r),f=R(p),k=new v;webInspector=new s};