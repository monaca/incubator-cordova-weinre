/*
 * Copyright (C) 2007 Apple Inc.  All rights reserved.
 * Copyright (C) 2009 Joseph Pecoraro
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
WebInspector.EventListenersSidebarPane=function(){WebInspector.SidebarPane.call(this,WebInspector.UIString("Event Listeners")),this.bodyElement.addStyleClass("events-pane"),this.sections=[],this.settingsSelectElement=document.createElement("select");var e=document.createElement("option");e.value="all",e.label=WebInspector.UIString("All Nodes"),this.settingsSelectElement.appendChild(e),(e=document.createElement("option")).value="selected",e.label=WebInspector.UIString("Selected Node Only"),this.settingsSelectElement.appendChild(e);var t=WebInspector.settings.eventListenersFilter;"all"===t?this.settingsSelectElement[0].selected=!0:"selected"===t&&(this.settingsSelectElement[1].selected=!0),this.settingsSelectElement.addEventListener("click",function(e){e.stopPropagation()},!1),this.settingsSelectElement.addEventListener("change",this._changeSetting.bind(this),!1),this.titleElement.appendChild(this.settingsSelectElement)},WebInspector.EventListenersSidebarPane.prototype={update:function(e){var p=this.bodyElement;p.removeChildren(),this.sections=[];var d=this;WebInspector.EventListeners.getEventListenersForNodeAsync(e,function(e,t){for(var n=[],s={},i=0;i<t.length;++i){var r=t[i];// no longer needed
if(r.node=WebInspector.domAgent.nodeForId(r.nodeId),delete r.nodeId,!/^function _inspectorCommandLineAPI_logEvent\(/.test(r.listenerBody.toString())){// ignore event listeners generated by monitorEvent
var o=r.type;(c=s[o])||(c=new WebInspector.EventListenersSection(o,e),s[o]=c,n.push(o),d.sections.push(c)),c.addListener(r)}}if(0===n.length){var l=document.createElement("div");return l.className="info",l.textContent=WebInspector.UIString("No Event Listeners"),void p.appendChild(l)}for(n.sort(),i=0;i<n.length;++i){var c;(c=s[n[i]]).update(),p.appendChild(c.element)}})},_changeSetting:function(e){var t=this.settingsSelectElement[this.settingsSelectElement.selectedIndex];WebInspector.settings.eventListenersFilter=t.value;for(var n=0;n<this.sections.length;++n)this.sections[n].update()}},WebInspector.EventListenersSidebarPane.prototype.__proto__=WebInspector.SidebarPane.prototype,WebInspector.EventListenersSection=function(e,t){this.eventListeners=[],this._nodeId=t,WebInspector.PropertiesSection.call(this,e),
// Changed from a Properties List
this.propertiesElement.parentNode.removeChild(this.propertiesElement),delete this.propertiesElement,delete this.propertiesTreeOutline,this.eventBars=document.createElement("div"),this.eventBars.className="event-bars",this.element.appendChild(this.eventBars)},WebInspector.EventListenersSection.prototype={update:function(){
// A Filtered Array simplifies when to create connectors
var e=this.eventListeners;if("selected"===WebInspector.settings.eventListenersFilter){e=[];for(var t=0;t<this.eventListeners.length;++t){(s=this.eventListeners[t]).node.id===this._nodeId&&e.push(s)}}this.eventBars.removeChildren();var n=e.length;for(t=0;t<n;++t){var s=e[t],i=new WebInspector.EventListenerBar(s,this._nodeId);this.eventBars.appendChild(i.element)}},addListener:function(e){this.eventListeners.push(e)}},WebInspector.EventListenersSection.prototype.__proto__=WebInspector.PropertiesSection.prototype,WebInspector.EventListenerBar=function(e,t){this.eventListener=e,this._nodeId=t,WebInspector.ObjectPropertiesSection.call(this),this._setNodeTitle(),this._setFunctionSubtitle(),this.editable=!1,this.element.className="event-bar",/* Changed from "section" */
this.headerElement.addStyleClass("source-code"),this.propertiesElement.className="event-properties properties-tree source-code"},WebInspector.EventListenerBar.prototype={update:function(){var e=this.eventListener.node;delete this.eventListener.node,WebInspector.RemoteObject.resolveNode(e,function(e){var t=[];for(var n in e&&t.push(new WebInspector.RemoteObjectProperty("node",e)),this.eventListener){var s=WebInspector.RemoteObject.fromPrimitiveValue(this.eventListener[n]);t.push(new WebInspector.RemoteObjectProperty(n,s))}this.updateProperties(t)}.bind(this))},_setNodeTitle:function(){var e=this.eventListener.node;e&&(e.nodeType!==Node.DOCUMENT_NODE?e.id!==this._nodeId?(this.titleElement.removeChildren(),this.titleElement.appendChild(WebInspector.panels.elements.linkifyNodeReference(this.eventListener.node))):this.titleElement.textContent=appropriateSelectorForNode(e):this.titleElement.textContent="document")},_setFunctionSubtitle:function(){
// Requires that Function.toString() return at least the function's signature.
if(this.eventListener.sourceName)this.subtitleElement.removeChildren(),this.subtitleElement.appendChild(WebInspector.linkifyResourceAsNode(this.eventListener.sourceName,"scripts",this.eventListener.lineNumber));else{var e=this.eventListener.listenerBody.match(/function ([^\(]+?)\(/);this.subtitleElement.textContent=e?e[1]:WebInspector.UIString("(anonymous function)")}}},WebInspector.EventListenerBar.prototype.__proto__=WebInspector.ObjectPropertiesSection.prototype;