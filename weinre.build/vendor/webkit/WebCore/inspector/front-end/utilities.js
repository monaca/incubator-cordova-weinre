/*
 * Copyright (C) 2007 Apple Inc.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer. 
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution. 
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission. 
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Contains diff method based on Javascript Diff Algorithm By John Resig
 * http://ejohn.org/files/jsdiff.js (released under the MIT license).
 */
function isNodeWhitespace(){return!(!this||this.nodeType!==Node.TEXT_NODE)&&(!this.nodeValue.length||this.nodeValue.match(/^[\s\xA0]+$/))}function nodeDisplayName(){if(!this)return"";switch(this.nodeType){case Node.DOCUMENT_NODE:return"Document";case Node.ELEMENT_NODE:var e="<"+this.nodeName.toLowerCase();if(this.hasAttributes()){var t=this.getAttribute("id");t&&(e+=' id="'+t+'"'),(t=this.getAttribute("class"))&&(e+=' class="'+t+'"'),"a"===this.nodeName.toLowerCase()?((t=this.getAttribute("name"))&&(e+=' name="'+t+'"'),(t=this.getAttribute("href"))&&(e+=' href="'+t+'"')):"img"===this.nodeName.toLowerCase()?(t=this.getAttribute("src"))&&(e+=' src="'+t+'"'):"iframe"===this.nodeName.toLowerCase()?(t=this.getAttribute("src"))&&(e+=' src="'+t+'"'):"input"===this.nodeName.toLowerCase()?((t=this.getAttribute("name"))&&(e+=' name="'+t+'"'),(t=this.getAttribute("type"))&&(e+=' type="'+t+'"')):"form"===this.nodeName.toLowerCase()&&(t=this.getAttribute("action"))&&(e+=' action="'+t+'"')}return e+">";case Node.TEXT_NODE:return isNodeWhitespace.call(this)?"(whitespace)":'"'+this.nodeValue+'"';case Node.COMMENT_NODE:return"\x3c!--"+this.nodeValue+"--\x3e";case Node.DOCUMENT_TYPE_NODE:var r="<!DOCTYPE "+this.nodeName;return this.publicId?(r+=' PUBLIC "'+this.publicId+'"',this.systemId&&(r+=' "'+this.systemId+'"')):this.systemId&&(r+=' SYSTEM "'+this.systemId+'"'),this.internalSubset&&(r+=" ["+this.internalSubset+"]"),r+">"}return this.nodeName.toLowerCase().collapseWhitespace()}function isAncestorNode(e,t){if(!t||!e)return!1;for(var r=t.parentNode;r;){if(e===r)return!0;r=r.parentNode}return!1}function isDescendantNode(e){return isAncestorNode(e,this)}function traverseNextNode(e){if(this){var t=this.firstChild;if(t)return t;if(e&&this===e)return null;if(t=this.nextSibling)return t;for(t=this;t&&!t.nextSibling&&(!e||!t.parentNode||t.parentNode!==e);)t=t.parentNode;return t?t.nextSibling:null}}function traversePreviousNode(e){if(this){if(e&&this===e)return null;for(var t=this.previousSibling;t&&t.lastChild;)t=t.lastChild;return t||this.parentNode}}function onlyTextChild(){if(!this)return null;var e=this.firstChild;return e&&e.nodeType===Node.TEXT_NODE?e.nextSibling?null:e:null}function appropriateSelectorForNode(e,t){if(!e)return"";var r=e.localName||e.nodeName.toLowerCase(),n=e.getAttribute("id");if(n){var o="#"+n;return t?o:r+o}var i=e.getAttribute("class");if(i){o="."+i.replace(/\s+/,".");return t?o:r+o}return"input"===r&&e.getAttribute("type")?r+'[type="'+e.getAttribute("type")+'"]':r}function getDocumentForNode(e){return e.nodeType==Node.DOCUMENT_NODE?e:e.ownerDocument}function parentNode(e){return e.parentNode}function insertionIndexForObjectInListSortedByFunction(e,t,r){for(var n,o,i=0,s=t.length-1,a=Math.floor;i<=s;)if(0<(o=r(e,t[n=a((i+s)/2)])))i=n+1;else{if(!(o<0)){
// Return the first occurance of an item in the list.
for(;0<n&&0===r(e,t[n-1]);)n--;i=n;break}s=n-1}return i}function isEnterKey(e){
// Check if in IME.
return 229!==e.keyCode&&"Enter"===e.key}function highlightSearchResult(e,t,r){var n=e.textContent,o=t+r,i=document.createElement("span");i.className="webkit-search-result",i.textContent=n.substring(t,o);var s=e.rangeBoundaryForOffset(t),a=s.container,u=a.textContent;if(s.offset+r<u.length){
// Selection belong to a single split mode.
a.textContent=u.substring(s.offset+r),a.parentElement.insertBefore(i,a);var l=document.createTextNode(u.substring(0,s.offset));return a.parentElement.insertBefore(l,i),i}var f=a.parentElement,c=a.nextSibling;for(r-=u.length-s.offset,a.textContent=u.substring(0,s.offset),a=a.traverseNextTextNode(e);a;){if(r<(u=a.textContent).length){a.textContent=u.substring(r);break}r-=u.length,a.textContent="",a=a.traverseNextTextNode(e)}return f.insertBefore(i,c),i}function createSearchRegex(e){for(var t="",r=0;r<e.length;++r){var n=e.charAt(r);"]"===n&&(n="\\]"),t+="["+n+"]"}return new RegExp(t,"i")}function offerFileForDownload(e){var t=new BlobBuilder;t.append(e);var r=t.getBlob("application/octet-stream"),n=window.webkitURL.createObjectURL(r);window.open(n)}Function.prototype.bind=function(e){var t=this,r=Array.prototype.slice.call(arguments,1);function n(){return t.apply(e,r.concat(Array.prototype.slice.call(arguments,0)))}return n.toString=function(){return"bound: "+t},n},Node.prototype.rangeOfWord=function(e,t,r,n){var o,i,s=0,a=0;if(r||(r=this),n&&"backward"!==n&&"both"!==n)o=this,s=e;else{for(var u=this;u;){if(u===r){o||(o=r);break}if(u.nodeType===Node.TEXT_NODE)for(var l=u===this?e-1:u.nodeValue.length-1;0<=l;--l)if(-1!==t.indexOf(u.nodeValue[l])){o=u,s=l+1;break}if(o)break;u=u.traversePreviousNode(r)}o||(o=r,s=0)}if(n&&"forward"!==n&&"both"!==n)i=this,a=e;else{for(u=this;u;){if(u===r){i||(i=r);break}if(u.nodeType===Node.TEXT_NODE)for(l=u===this?e:0;l<u.nodeValue.length;++l)if(-1!==t.indexOf(u.nodeValue[l])){i=u,a=l;break}if(i)break;u=u.traverseNextNode(r)}i||(a=(i=r).nodeType===Node.TEXT_NODE?r.nodeValue.length:r.childNodes.length)}var f=this.ownerDocument.createRange();return f.setStart(o,s),f.setEnd(i,a),f},Node.prototype.traverseNextTextNode=function(e){var t=this.traverseNextNode(e);if(t){for(;t&&t.nodeType!==Node.TEXT_NODE;)t=t.traverseNextNode(e);return t}},Node.prototype.rangeBoundaryForOffset=function(e){for(var t=this.traverseNextTextNode(this);t&&e>t.nodeValue.length;)e-=t.nodeValue.length,t=t.traverseNextTextNode(this);return t?{container:t,offset:e}:{container:this,offset:0}},Element.prototype.removeStyleClass=function(t){
// Test for the simple case first.
this.className!==t?-1!==this.className.indexOf(t)&&(this.className=this.className.split(" ").filter(function(e){return e&&e!==t}).join(" ")):this.className=""},Element.prototype.removeMatchingStyleClasses=function(e){var t=new RegExp("(^|\\s+)"+e+"($|\\s+)");t.test(this.className)&&(this.className=this.className.replace(t," "))},Element.prototype.addStyleClass=function(e){e&&!this.hasStyleClass(e)&&(this.className+=this.className.length?" "+e:e)},Element.prototype.hasStyleClass=function(e){if(!e)return!1;
// Test for the simple case
if(this.className===e)return!0;var t=this.className.indexOf(e);return-1!==t&&-1!==(" "+this.className+" ").indexOf(" "+e+" ",t)},Element.prototype.positionAt=function(e,t){this.style.left=e+"px",this.style.top=t+"px"},Element.prototype.pruneEmptyTextNodes=function(){for(var e=this.firstChild;e;){var t=e.nextSibling;e.nodeType===this.TEXT_NODE&&""===e.nodeValue&&this.removeChild(e),e=t}},Element.prototype.isScrolledToBottom=function(){
// This code works only for 0-width border
return this.scrollTop+this.clientHeight===this.scrollHeight},Node.prototype.enclosingNodeOrSelfWithNodeNameInArray=function(e){for(var t=this;t&&t!==this.ownerDocument;t=t.parentNode)for(var r=0;r<e.length;++r)if(t.nodeName.toLowerCase()===e[r].toLowerCase())return t;return null},Node.prototype.enclosingNodeOrSelfWithNodeName=function(e){return this.enclosingNodeOrSelfWithNodeNameInArray([e])},Node.prototype.enclosingNodeOrSelfWithClass=function(e){for(var t=this;t&&t!==this.ownerDocument;t=t.parentNode)if(t.nodeType===Node.ELEMENT_NODE&&t.hasStyleClass(e))return t;return null},Node.prototype.enclosingNodeWithClass=function(e){return this.parentNode?this.parentNode.enclosingNodeOrSelfWithClass(e):null},Element.prototype.query=function(e){return this.ownerDocument.evaluate(e,this,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue},Element.prototype.removeChildren=function(){this.firstChild&&(this.textContent="")},Element.prototype.isInsertionCaretInside=function(){var e=window.getSelection();if(!e.rangeCount||!e.isCollapsed)return!1;var t=e.getRangeAt(0);return t.startContainer===this||t.startContainer.isDescendant(this)},Element.prototype.createChild=function(e,t){var r=document.createElement(e);return t&&(r.className=t),this.appendChild(r),r},Element.prototype.__defineGetter__("totalOffsetLeft",function(){for(var e=0,t=this;t;t=t.offsetParent)e+=t.offsetLeft+(this!==t?t.clientLeft:0);return e}),Element.prototype.__defineGetter__("totalOffsetTop",function(){for(var e=0,t=this;t;t=t.offsetParent)e+=t.offsetTop+(this!==t?t.clientTop:0);return e}),Element.prototype.offsetRelativeToWindow=function(e){for(var t={x:0,y:0},r=this,n=this.ownerDocument.defaultView;n&&r&&(t.x+=r.totalOffsetLeft,t.y+=r.totalOffsetTop,n!==e);)r=n.frameElement,n=n.parent;return t},KeyboardEvent.prototype.__defineGetter__("data",function(){
// Emulate "data" attribute from DOM 3 TextInput event.
// See http://www.w3.org/TR/DOM-Level-3-Events/#events-Events-TextEvent-data
switch(this.type){case"keypress":return this.ctrlKey||this.metaKey?"":String.fromCharCode(this.charCode);case"keydown":case"keyup":return this.ctrlKey||this.metaKey||this.altKey?"":String.fromCharCode(this.which)}}),Text.prototype.select=function(e,t){e=e||0,t=t||this.textContent.length,e<0&&(e=t+e);var r=window.getSelection();r.removeAllRanges();var n=document.createRange();return n.setStart(this,e),n.setEnd(this,t),r.addRange(n),this},Element.prototype.__defineGetter__("selectionLeftOffset",function(){
// Calculate selection offset relative to the current element.
var e=window.getSelection();if(!e.containsNode(this,!0))return null;for(var t=e.anchorOffset,r=e.anchorNode;r!==this;){for(;r.previousSibling;)t+=(r=r.previousSibling).textContent.length;r=r.parentNode}return t}),Node.prototype.isWhitespace=isNodeWhitespace,Node.prototype.displayName=nodeDisplayName,Node.prototype.isAncestor=function(e){return isAncestorNode(this,e)},Node.prototype.isDescendant=isDescendantNode,Node.prototype.traverseNextNode=traverseNextNode,Node.prototype.traversePreviousNode=traversePreviousNode,Node.prototype.onlyTextChild=onlyTextChild,String.prototype.hasSubstring=function(e,t){return t?this.match(new RegExp(e.escapeForRegExp(),"i")):-1!==this.indexOf(e)},String.prototype.findAll=function(e){for(var t=[],r=this.indexOf(e);-1!==r;)t.push(r),r=this.indexOf(e,r+e.length);return t},String.prototype.lineEndings=function(){return this._lineEndings||(this._lineEndings=this.findAll("\n"),this._lineEndings.push(this.length)),this._lineEndings},String.prototype.asParsedURL=function(){
// RegExp groups:
// 1 - scheme
// 2 - hostname
// 3 - ?port
// 4 - ?path
// 5 - ?fragment
var e=this.match(/^([^:]+):\/\/([^\/:]*)(?::([\d]+))?(?:(\/[^#]*)(?:#(.*))?)?$/i);if(!e)return null;var t={};return t.scheme=e[1].toLowerCase(),t.host=e[2],t.port=e[3],t.path=e[4]||"/",t.fragment=e[5],t},String.prototype.escapeCharacters=function(e){for(var t=!1,r=0;r<e.length;++r)if(-1!==this.indexOf(e.charAt(r))){t=!0;break}if(!t)return this;var n="";for(r=0;r<this.length;++r)-1!==e.indexOf(this.charAt(r))&&(n+="\\"),n+=this.charAt(r);return n},String.prototype.escapeForRegExp=function(){return this.escapeCharacters("^[]{}()\\.$*+?|")},String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},String.prototype.collapseWhitespace=function(){return this.replace(/[\s\xA0]+/g," ")},String.prototype.trimURL=function(e){var t=this.replace(/^(https|http|file):\/\//i,"");return e&&(t=t.replace(new RegExp("^"+e.escapeForRegExp(),"i"),"")),t},Number.millisToString=function(e,t){return Number.secondsToString(e/1e3,t)},Number.secondsToString=function(e,t){if(0===e)return"0";var r=1e3*e;if(t&&r<1e3)return WebInspector.UIString("%.3fms",r);if(r<1e3)return WebInspector.UIString("%.0fms",r);if(e<60)return WebInspector.UIString("%.2fs",e);var n=e/60;if(n<60)return WebInspector.UIString("%.1fmin",n);var o=n/60;if(o<24)return WebInspector.UIString("%.1fhrs",o);var i=o/24;return WebInspector.UIString("%.1f days",i)},Number.bytesToString=function(e,t){if(void 0===t&&(t=!0),e<1024)return WebInspector.UIString("%.0fB",e);var r=e/1024;if(t&&r<1024)return WebInspector.UIString("%.2fKB",r);if(r<1024)return WebInspector.UIString("%.0fKB",r);var n=r/1024;return t?WebInspector.UIString("%.2fMB",n):WebInspector.UIString("%.0fMB",n)},Number.constrain=function(e,t,r){return e<t?e=t:r<e&&(e=r),e},HTMLTextAreaElement.prototype.moveCursorToEnd=function(){var e=this.value.length;this.setSelectionRange(e,e)},Object.defineProperty(Array.prototype,"remove",{value:function(e,t){if(t){var r=this.indexOf(e);-1!==r&&this.splice(r,1)}else for(var n=this.length,o=0;o<n;++o)this[o]===e&&this.splice(o,1)}}),Object.defineProperty(Array.prototype,"keySet",{value:function(){for(var e={},t=0;t<this.length;++t)e[this[t]]=!0;return e}}),Object.defineProperty(Array.prototype,"upperBound",{value:function(e){for(var t=0,r=this.length;0<r;){var n=r>>1,o=t+n;e>=this[o]?(t=o+1,r-=n+1):r=n}return t}}),Array.diff=function(e,t){for(var r=e,n=t,o={},i={},s=0;s<n.length;s++)null==o[n[s]]&&(o[n[s]]={rows:[],o:null}),o[n[s]].rows.push(s);for(s=0;s<r.length;s++)null==i[r[s]]&&(i[r[s]]={rows:[],n:null}),i[r[s]].rows.push(s);for(var s in o)1==o[s].rows.length&&void 0!==i[s]&&1==i[s].rows.length&&(n[o[s].rows[0]]={text:n[o[s].rows[0]],row:i[s].rows[0]},r[i[s].rows[0]]={text:r[i[s].rows[0]],row:o[s].rows[0]});for(s=0;s<n.length-1;s++)null!=n[s].text&&null==n[s+1].text&&n[s].row+1<r.length&&null==r[n[s].row+1].text&&n[s+1]==r[n[s].row+1]&&(n[s+1]={text:n[s+1],row:n[s].row+1},r[n[s].row+1]={text:r[n[s].row+1],row:s+1});for(s=n.length-1;0<s;s--)null!=n[s].text&&null==n[s-1].text&&0<n[s].row&&null==r[n[s].row-1].text&&n[s-1]==r[n[s].row-1]&&(n[s-1]={text:n[s-1],row:n[s].row-1},r[n[s].row-1]={text:r[n[s].row-1],row:s-1});return{left:r,right:n}},Array.convert=function(e){
// Cast array-like object to an array.
return Array.prototype.slice.call(e)},String.sprintf=function(e){return String.vsprintf(e,Array.prototype.slice.call(arguments,1))},String.tokenizeFormatString=function(e){var t=[],r=0;function n(e){t.push({type:"string",value:e})}for(var o,i,s,a=0,u=e.indexOf("%",a);-1!==u;u=e.indexOf("%",a))if(n(e.substring(a,u)),"%"!==e[a=u+1]){if(!isNaN(e[a])){for(
// The first character is a number, it might be a substitution index.
var l=parseInt(e.substring(a));!isNaN(e[a]);)++a;
// If the number is greater than zero and ends with a "$",
// then this is a substitution index.
0<l&&"$"===e[a]&&(r=l-1,++a)}var f=-1;if("."===e[a])for(
// This is a precision specifier. If no digit follows the ".",
// then the precision should be zero.
++a,f=parseInt(e.substring(a)),isNaN(f)&&(f=0);!isNaN(e[a]);)++a;o=e[a],i=f,s=r,t.push({type:"specifier",specifier:o,precision:i,substitutionIndex:s}),++r,++a}else n("%"),++a;return n(e.substring(a)),t},String.standardFormatters={d:function(e){return"object"==typeof e&&"number"===WebInspector.RemoteObject.type(e)&&(e=e.description),e=parseInt(e),isNaN(e)?0:e},f:function(e,t){return"object"==typeof e&&"number"===WebInspector.RemoteObject.type(e)&&(e=e.description),(e=parseFloat(e))&&-1<t.precision&&(e=e.toFixed(t.precision)),isNaN(e)?-1<t.precision?Number(0).toFixed(t.precision):0:e},s:function(e){return"object"==typeof e&&"null"!==WebInspector.RemoteObject.type(e)&&(e=e.description),e}},String.vsprintf=function(e,t){return String.format(e,t,String.standardFormatters,"",function(e,t){return e+t}).formattedResult},String.format=function(e,t,r,n,o){if(!e||!t||!t.length)return{formattedResult:o(n,e),unusedSubstitutions:t};function i(){return'String.format("'+e+'", "'+t.join('", "')+'")'}function s(e){console.error(i()+": "+e)}for(var a,u=n,l=String.tokenizeFormatString(e),f={},c=0;c<l.length;++c){var p=l[c];"string"!==p.type?"specifier"===p.type?u=p.substitutionIndex>=t.length?(
// If there are not enough substitutions for the current substitutionIndex
// just output the format specifier literally and move on.
s("not enough substitution arguments. Had "+t.length+" but needed "+(p.substitutionIndex+1)+", so substitution was skipped."),o(u,"%"+(-1<p.precision?p.precision:"")+p.specifier)):(f[p.substitutionIndex]=!0,p.specifier in r?o(u,r[p.specifier](t[p.substitutionIndex],p)):(
// Encountered an unsupported format character, treat as a string.
a="unsupported format character “"+p.specifier+"”. Treating as a string.",console.warn(i()+": "+a),o(u,t[p.substitutionIndex]))):s('Unknown token type "'+p.type+'" found.'):u=o(u,p.value)}var h=[];for(c=0;c<t.length;++c)c in f||h.push(t[c]);return{formattedResult:u,unusedSubstitutions:h}};