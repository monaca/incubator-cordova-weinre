/*
 * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.
 * Copyright (C) 2009 Joseph Pecoraro
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var ExpressionStopCharacters=" =:[({;,!+-*/&|^<>";WebInspector.ConsoleView=function(e){WebInspector.View.call(this,document.getElementById("console-view")),this.messages=[],this.drawer=e,this.clearButton=document.getElementById("clear-console-status-bar-item"),this.clearButton.title=WebInspector.UIString("Clear console log."),this.clearButton.addEventListener("click",this._clearButtonClicked.bind(this),!1),this.messagesElement=document.getElementById("console-messages"),this.messagesElement.addEventListener("selectstart",this._messagesSelectStart.bind(this),!1),this.messagesElement.addEventListener("click",this._messagesClicked.bind(this),!0),this.promptElement=document.getElementById("console-prompt"),this.promptElement.className="source-code",this.promptElement.addEventListener("keydown",this._promptKeyDown.bind(this),!0),this.prompt=new WebInspector.TextPrompt(this.promptElement,this.completions.bind(this),ExpressionStopCharacters+"."),this.prompt.history=WebInspector.settings.consoleHistory,this.topGroup=new WebInspector.ConsoleGroup(null),this.messagesElement.insertBefore(this.topGroup.element,this.promptElement),this.currentGroup=this.topGroup,this.toggleConsoleButton=document.getElementById("console-status-bar-item"),this.toggleConsoleButton.title=WebInspector.UIString("Show console."),this.toggleConsoleButton.addEventListener("click",this._toggleConsoleButtonClicked.bind(this),!1),
// Will hold the list of filter elements
this.filterBarElement=document.getElementById("console-filter");var o=this._updateFilter.bind(this);function s(e,s){var t=document.createElement("li");return t.category=e,t.className=e,t.addEventListener("click",o,!1),t.textContent=s,this.filterBarElement.appendChild(t),t}this.allElement=s.call(this,"all",WebInspector.UIString("Debug")),this.logElement=s.call(this,"logs",WebInspector.UIString("Log")),this.warningElement=s.call(this,"warnings",WebInspector.UIString("Warning")),this.errorElement=s.call(this,"errors",WebInspector.UIString("Error")),this.filter(this.logElement,!1),
//createDividerElement.call(this);
//this.filter(this.allElement, false);
this._registerShortcuts(),this.messagesElement.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),!1),this._customFormatters={object:this._formatobject,array:this._formatarray,node:this._formatnode,string:this._formatstring},this._registerConsoleDomainDispatcher()},WebInspector.ConsoleView.prototype={_registerConsoleDomainDispatcher:function(){var n=this,e={addConsoleMessage:function(e){var s=new WebInspector.ConsoleMessage(e.source,e.type,e.level,e.line,e.url,e.repeatCount,e.message,e.parameters,e.stackTrace,e.requestId);n.addMessage(s)},updateConsoleMessageExpiredCount:function(e){var s=String.sprintf(WebInspector.UIString("%d console messages are not shown."),e);n.addMessage(WebInspector.ConsoleMessage.createTextMessage(s,WebInspector.ConsoleMessage.MessageLevel.Warning))},updateConsoleMessageRepeatCount:function(e){var s=n.previousMessage,t=s.totalRepeatCount;if(n.commandSincePreviousMessage){var o=new WebInspector.ConsoleMessage(s.source,s.type,s.level,s.line,s.url,e-t,s._messageText,s._parameters,s._stackTrace,s._requestId);o.totalRepeatCount=e,o._formatMessage(),n.addMessage(o)}else s.repeatDelta=e-t,s.repeatCount=s.repeatCount+s.repeatDelta,s.totalRepeatCount=e,s._updateRepeatCount(),n._incrementErrorWarningCount(s)},consoleMessagesCleared:function(){n.clearMessages()}};InspectorBackend.registerDomainDispatcher("Console",e)},_updateFilter:function(e){var s=WebInspector.isMac(),t=!1;!s||!e.metaKey||e.ctrlKey||e.altKey||e.shiftKey||(t=!0),s||!e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||(t=!0),this.filter(e.target,t)},filter:function(e,s){function t(){this.allElement.removeStyleClass("selected"),this.errorElement.removeStyleClass("selected"),this.warningElement.removeStyleClass("selected"),this.logElement.removeStyleClass("selected"),this.messagesElement.removeStyleClass("filter-all"),this.messagesElement.removeStyleClass("filter-errors"),this.messagesElement.removeStyleClass("filter-warnings"),this.messagesElement.removeStyleClass("filter-logs")}var o="filter-"+e.category;if("all"===e.category){if(e.hasStyleClass("selected"))
// We can't unselect all, so we break early here
return;t.call(this)}else
// Something other than all is being selected, so we want to unselect all
this.allElement.hasStyleClass("selected")&&(this.allElement.removeStyleClass("selected"),this.messagesElement.removeStyleClass("filter-all"));if(!s)
// If multiple selection is off, we want to unselect everything else
// and just select ourselves.
return t.call(this),e.addStyleClass("selected"),void this.messagesElement.addStyleClass(o);e.hasStyleClass("selected")?(
// If selectMultiple is turned on, and we were selected, we just
// want to unselect ourselves.
e.removeStyleClass("selected"),this.messagesElement.removeStyleClass(o)):(
// If selectMultiple is turned on, and we weren't selected, we just
// want to select ourselves.
e.addStyleClass("selected"),this.messagesElement.addStyleClass(o))},_toggleConsoleButtonClicked:function(){this.drawer.visibleView=this},attach:function(e,s){e.appendChild(this.element),s.appendChild(this.clearButton),s.appendChild(this.filterBarElement)},show:function(){this.toggleConsoleButton.addStyleClass("toggled-on"),this.toggleConsoleButton.title=WebInspector.UIString("Hide console."),this.prompt.isCaretInsidePrompt()||this.prompt.moveCaretToEndOfPrompt()},afterShow:function(){WebInspector.currentFocusElement=this.promptElement},hide:function(){this.toggleConsoleButton.removeStyleClass("toggled-on"),this.toggleConsoleButton.title=WebInspector.UIString("Show console.")},_scheduleScrollIntoView:function(){this._scrollIntoViewTimer||(this._scrollIntoViewTimer=setTimeout(function(){this.promptElement.scrollIntoView(!0),delete this._scrollIntoViewTimer}.bind(this),20))},addMessage:function(e){var s=this.messagesElement.isScrolledToBottom();if(e instanceof WebInspector.ConsoleMessage&&!(e instanceof WebInspector.ConsoleCommandResult)?(this._incrementErrorWarningCount(e),WebInspector.resourceTreeModel.addConsoleMessage(e),WebInspector.panels.scripts.addConsoleMessage(e),this.commandSincePreviousMessage=!1,this.previousMessage=e):e instanceof WebInspector.ConsoleCommand&&this.previousMessage&&(this.commandSincePreviousMessage=!0),this.messages.push(e),e.type===WebInspector.ConsoleMessage.MessageType.EndGroup){var t=this.currentGroup.parentGroup;t&&(this.currentGroup=t)}else{if(e.type===WebInspector.ConsoleMessage.MessageType.StartGroup||e.type===WebInspector.ConsoleMessage.MessageType.StartGroupCollapsed){var o=new WebInspector.ConsoleGroup(this.currentGroup);this.currentGroup.messagesElement.appendChild(o.element),this.currentGroup=o}this.currentGroup.addMessage(e)}s&&this._scheduleScrollIntoView()},_incrementErrorWarningCount:function(e){switch(e.level){case WebInspector.ConsoleMessage.MessageLevel.Warning:WebInspector.warnings+=e.repeatDelta;break;case WebInspector.ConsoleMessage.MessageLevel.Error:WebInspector.errors+=e.repeatDelta}},requestClearMessages:function(){InspectorBackend.clearConsoleMessages()},clearMessages:function(){WebInspector.resourceTreeModel.clearConsoleMessages(),WebInspector.panels.scripts.clearConsoleMessages(),this.messages=[],this.currentGroup=this.topGroup,this.topGroup.messagesElement.removeChildren(),WebInspector.errors=0,WebInspector.warnings=0,delete this.commandSincePreviousMessage,delete this.previousMessage},completions:function(e,s,t){
// Pass less stop characters to rangeOfWord so the range will be a more complete expression.
var o=e.startContainer.rangeOfWord(e.startOffset,ExpressionStopCharacters,this.promptElement,"backward").toString(),n=o.length-1,r="."===o[n],a="["===o[n];(r||a)&&(o=o.substr(0,n));var i=e.toString();if(o||i){var l=this._reportCompletions.bind(this,s,t,r,a,i),c=!r&&!a;
// Collect comma separated object properties for the completion.
WebInspector.panels.scripts&&WebInspector.panels.scripts.paused?InspectorBackend.getCompletionsOnCallFrame(WebInspector.panels.scripts.selectedCallFrameId(),o,c,l):InspectorBackend.getCompletions(o,c,l)}},_reportCompletions:function(e,s,t,o,n,r,a){if(!a){if(o)if(n.length&&"'"===n[0])var i="'";else i='"';for(var l=[],c=Object.keys(r).sort(),p=0;p<c.length;++p){var d=c[p];if((!t||/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(d))&&(o&&(/^[0-9]+$/.test(d)||(d=i+d.escapeCharacters(i+"\\")+i),d+="]"),!(d.length<n.length)&&0===d.indexOf(n)&&(l.push(d),e)))break}s(l)}},_clearButtonClicked:function(){this.requestClearMessages()},_handleContextMenuEvent:function(e){if(window.getSelection().isCollapsed){var s=function(){WebInspector.settings.monitoringXHREnabled=!WebInspector.settings.monitoringXHREnabled,InspectorBackend.setMonitoringXHREnabled(WebInspector.settings.monitoringXHREnabled)}.bind(this),t=new WebInspector.ContextMenu;t.appendCheckboxItem(WebInspector.UIString("XMLHttpRequest logging"),s,WebInspector.settings.monitoringXHREnabled),t.appendItem(WebInspector.UIString("Clear Console"),this.requestClearMessages.bind(this)),t.show(e)}},_messagesSelectStart:function(e){this._selectionTimeout&&clearTimeout(this._selectionTimeout),this.prompt.clearAutoComplete(),this._selectionTimeout=setTimeout(function(){delete this._selectionTimeout,!this.prompt.isCaretInsidePrompt()&&window.getSelection().isCollapsed&&this.prompt.moveCaretToEndOfPrompt(),this.prompt.autoCompleteSoon()}.bind(this),100)},_messagesClicked:function(e){var s=e.target.enclosingNodeOrSelfWithNodeName("a");s&&s.representedNode&&(WebInspector.updateFocusedNode(s.representedNode.id),e.stopPropagation(),e.preventDefault())},_registerShortcuts:function(){this._shortcuts={};var e=WebInspector.KeyboardShortcut,s=e.makeDescriptor("k",WebInspector.KeyboardShortcut.Modifiers.Meta);
// This case requires a separate bound function as its isMacOnly property should not be shared among different shortcut handlers.
this._shortcuts[s.key]=this.requestClearMessages.bind(this),this._shortcuts[s.key].isMacOnly=!0;var t=this.requestClearMessages.bind(this),o=e.makeDescriptor("l",WebInspector.KeyboardShortcut.Modifiers.Ctrl);this._shortcuts[o.key]=t;var n=WebInspector.shortcutsHelp.section(WebInspector.UIString("Console")),r=WebInspector.isMac()?[s.name,o.name]:[o.name];n.addAlternateKeys(r,WebInspector.UIString("Clear Console")),r=[e.shortcutToString(e.Keys.Tab),e.shortcutToString(e.Keys.Tab,e.Modifiers.Shift)],n.addRelatedKeys(r,WebInspector.UIString("Next/previous suggestion")),n.addKey(e.shortcutToString(e.Keys.Right),WebInspector.UIString("Accept suggestion")),r=[e.shortcutToString(e.Keys.Down),e.shortcutToString(e.Keys.Up)],n.addRelatedKeys(r,WebInspector.UIString("Next/previous line")),r=[e.shortcutToString("N",e.Modifiers.Alt),e.shortcutToString("P",e.Modifiers.Alt)],WebInspector.isMac()&&n.addRelatedKeys(r,WebInspector.UIString("Next/previous command")),n.addKey(e.shortcutToString(e.Keys.Enter),WebInspector.UIString("Execute command"))},_promptKeyDown:function(e){if(!isEnterKey(e)){var s=WebInspector.KeyboardShortcut.makeKeyFromEvent(e),t=this._shortcuts[s];return!t||this._shortcuts[s].isMacOnly&&!WebInspector.isMac()?void 0:(t(),void e.preventDefault())}this._enterKeyPressed(e)},evalInInspectedWindow:function(e,s,t,o){WebInspector.panels.scripts&&WebInspector.panels.scripts.paused?WebInspector.panels.scripts.evaluateInSelectedCallFrame(e,!1,s,t,o):(e||(
// There is no expression, so the completion should happen against global properties.
e="this"),InspectorBackend.evaluate(e,s,t,function(e){o(WebInspector.RemoteObject.fromPayload(e))}))},_enterKeyPressed:function(e){if(!(e.altKey||e.ctrlKey||e.shiftKey)){e.preventDefault(),e.stopPropagation(),this.prompt.clearAutoComplete(!0);var s=this.prompt.text;if(s.length){var t=new WebInspector.ConsoleCommand(s);this.addMessage(t);var o=this;this.evalInInspectedWindow(s,"console",!0,function(e){o.prompt.history.push(s),o.prompt.historyOffset=0,o.prompt.text="",WebInspector.settings.consoleHistory=o.prompt.history.slice(-30),o.addMessage(new WebInspector.ConsoleCommandResult(e,t))})}}},_format:function(e,s){var t=null!=e&&"object"==typeof e,o=s?"object":WebInspector.RemoteObject.type(e),n=this._customFormatters[o];n&&t||(n=this._formatvalue,e=e.description);var r=document.createElement("span");return r.className="console-formatted-"+o+" source-code",n.call(this,e,r),r},_formatvalue:function(e,s){s.appendChild(document.createTextNode(e))},_formatobject:function(e,s){s.appendChild(new WebInspector.ObjectPropertiesSection(e,e.description,null,!0).element)},_formatnode:function(t,o){t.pushNodeToFrontend(function(e){if(e){var s=new WebInspector.ElementsTreeOutline;s.showInElementsPanelEnabled=!0,s.rootDOMNode=WebInspector.domAgent.nodeForId(e),s.element.addStyleClass("outline-disclosure"),s.children[0].hasChildren||s.element.addStyleClass("single-node"),o.appendChild(s.element)}else
// Sometimes DOM is loaded after the sync message is being formatted, so we get no
// nodeId here. So we fall back to object formatting here.
this._formatobject(t,o)}.bind(this))},_formatarray:function(e,s){e.getOwnProperties(!1,this._printArray.bind(this,s))},_formatstring:function(e,s){var t=document.createElement("span");t.className="console-formatted-string source-code",t.appendChild(WebInspector.linkifyStringAsFragment(e.description)),
// Make black quotes.
s.removeStyleClass("console-formatted-string"),s.appendChild(document.createTextNode('"')),s.appendChild(t),s.appendChild(document.createTextNode('"'))},_printArray:function(e,s){if(s){for(var t=[],o=0;o<s.length;++o){var n=s[o].name;n==parseInt(n)&&(t[n]=this._formatAsArrayEntry(s[o].value))}e.appendChild(document.createTextNode("["));for(o=0;o<t.length;++o){var r=t[o];r?e.appendChild(r):e.appendChild(document.createTextNode("undefined")),o<t.length-1&&e.appendChild(document.createTextNode(", "))}e.appendChild(document.createTextNode("]"))}},_formatAsArrayEntry:function(e){
// Prevent infinite expansion of cross-referencing arrays.
return this._format(e,"array"===WebInspector.RemoteObject.type(e))}},WebInspector.ConsoleView.prototype.__proto__=WebInspector.View.prototype,WebInspector.ConsoleMessage=function(e,s,t,o,n,r,a,i,l,c){if(this.source=e,this.type=s,this.level=t,this.line=o,this.url=n,this.repeatCount=r,this.repeatDelta=r,this.totalRepeatCount=r,this._messageText=a,this._parameters=i,this._stackTrace=l,this._requestId=c,l&&l.length){var p=l[0];this.url||(this.url=p.scriptName),this.line||(this.line=p.lineNumber)}this._formatMessage()},WebInspector.ConsoleMessage.createTextMessage=function(e,s){return s=s||WebInspector.ConsoleMessage.MessageLevel.Log,new WebInspector.ConsoleMessage(WebInspector.ConsoleMessage.MessageSource.JS,WebInspector.ConsoleMessage.MessageType.Log,s,0,null,1,null,[e],null)},WebInspector.ConsoleMessage.prototype={_formatMessage:function(){var e;this._stackTrace;switch(this.type){case WebInspector.ConsoleMessage.MessageType.Trace:e=document.createTextNode("console.trace()");break;case WebInspector.ConsoleMessage.MessageType.UncaughtException:e=document.createTextNode(this._messageText);break;case WebInspector.ConsoleMessage.MessageType.NetworkError:var s=this._requestId&&WebInspector.networkResourceById(this._requestId);s?(s.stackTrace,(e=document.createElement("span")).appendChild(document.createTextNode(s.requestMethod+" ")),e.appendChild(WebInspector.linkifyURLAsNode(s.url)),s.failed?e.appendChild(document.createTextNode(" "+s.localizedFailDescription)):e.appendChild(document.createTextNode(" "+s.statusCode+" ("+s.statusText+")"))):e=this._format([this._messageText]);break;case WebInspector.ConsoleMessage.MessageType.Assert:var t=[WebInspector.UIString("Assertion failed:")];this._parameters&&(t=t.concat(this._parameters)),e=this._format(t);break;case WebInspector.ConsoleMessage.MessageType.Object:t=["%O",this._parameters?this._parameters[0]:void 0];e=this._format(t);break;default:t=this._parameters||[this._messageText];e=this._format(t)}if(this._formattedMessage=document.createElement("span"),this._formattedMessage.className="console-message-text source-code",this.url&&"undefined"!==this.url){var o=WebInspector.linkifyResourceAsNode(this.url,"scripts",this.line,"console-message-url");this._formattedMessage.appendChild(o)}if(this._formattedMessage.appendChild(e),this._stackTrace)switch(this.type){case WebInspector.ConsoleMessage.MessageType.Trace:case WebInspector.ConsoleMessage.MessageType.UncaughtException:case WebInspector.ConsoleMessage.MessageType.NetworkError:case WebInspector.ConsoleMessage.MessageType.Assert:var n=document.createElement("ol");n.className="outline-disclosure";var r=new TreeOutline(n),a=this._formattedMessage,i=new TreeElement(a,null,!0);a.treeElementForTest=i,r.appendChild(i),this.type===WebInspector.ConsoleMessage.MessageType.Trace&&i.expand(),this._populateStackTraceTreeElement(i),this._formattedMessage=n}
// This is used for inline message bubbles in SourceFrames, or other plain-text representations.
this.message=this._formattedMessage.textContent},isErrorOrWarning:function(){return this.level===WebInspector.ConsoleMessage.MessageLevel.Warning||this.level===WebInspector.ConsoleMessage.MessageLevel.Error},_format:function(e){
// This node is used like a Builder. Values are continually appended onto it.
var s=document.createElement("span");if(!e.length)return s;
// Formatting code below assumes that parameters are all wrappers whereas frontend console
// API allows passing arbitrary values as messages (strings, numbers, etc.). Wrap them here.
for(var t=0;t<e.length;++t)"object"==typeof e[t]?e[t]=WebInspector.RemoteObject.fromPayload(e[t]):e[t]=WebInspector.RemoteObject.fromPrimitiveValue(e[t]);
// There can be string log and string eval result. We distinguish between them based on message type.
var o="string"===WebInspector.RemoteObject.type(e[0])&&this.type!==WebInspector.ConsoleMessage.MessageType.Result;
// Multiple parameters with the first being a format string. Save unused substitutions.
o&&((e=this._formatWithSubstitutionString(e,s).unusedSubstitutions).length&&s.appendChild(document.createTextNode(" ")));
// Single parameter, or unused substitutions from above.
for(t=0;t<e.length;++t)
// Inline strings when formatting.
o&&"string"===e[t].type?s.appendChild(document.createTextNode(e[t].description)):s.appendChild(WebInspector.console._format(e[t])),t<e.length-1&&s.appendChild(document.createTextNode(" "));return s},_formatWithSubstitutionString:function(e,s){var t={};for(var o in String.standardFormatters)t[o]=String.standardFormatters[o];function n(s){return function(e){return WebInspector.console._format(e,s)}}
// Firebug uses %o for formatting objects.
// String.format does treat formattedResult like a Builder, result is an object.
return t.o=n(),
// Firebug allows both %i and %d for formatting integers.
t.i=t.d,
// Support %O to force object formatting, instead of the type-based %o formatting.
t.O=n(!0),String.format(e[0].description,e.slice(1),t,s,function(e,s){return s instanceof Node?e.appendChild(s):e.appendChild(WebInspector.linkifyStringAsFragment(s.toString())),e})},toMessageElement:function(){if(this._element)return this._element;var e=document.createElement("div");switch(e.message=this,e.className="console-message",this._element=e,this.level){case WebInspector.ConsoleMessage.MessageLevel.Tip:e.addStyleClass("console-tip-level");break;case WebInspector.ConsoleMessage.MessageLevel.Log:e.addStyleClass("console-log-level");break;case WebInspector.ConsoleMessage.MessageLevel.Debug:e.addStyleClass("console-debug-level");break;case WebInspector.ConsoleMessage.MessageLevel.Warning:e.addStyleClass("console-warning-level");break;case WebInspector.ConsoleMessage.MessageLevel.Error:e.addStyleClass("console-error-level")}return this.type!==WebInspector.ConsoleMessage.MessageType.StartGroup&&this.type!==WebInspector.ConsoleMessage.MessageType.StartGroupCollapsed||e.addStyleClass("console-group-title"),this.elementsTreeOutline?(e.addStyleClass("outline-disclosure"),e.appendChild(this.elementsTreeOutline.element)):(e.appendChild(this._formattedMessage),1<this.repeatCount&&this._updateRepeatCount()),e},_populateStackTraceTreeElement:function(e){for(var s=0;s<this._stackTrace.length;s++){var t=this._stackTrace[s],o=document.createElement("div"),n=document.createElement("span");n.className="console-message-text source-code";var r=t.functionName||WebInspector.UIString("(anonymous function)");n.appendChild(document.createTextNode(r)),o.appendChild(n);var a=WebInspector.linkifyResourceAsNode(t.scriptName,"scripts",t.lineNumber,"console-message-url");o.appendChild(a);var i=new TreeElement(o);e.appendChild(i)}},_updateRepeatCount:function(){this.repeatCountElement||(this.repeatCountElement=document.createElement("span"),this.repeatCountElement.className="bubble",this._element.insertBefore(this.repeatCountElement,this._element.firstChild),this._element.addStyleClass("repeated-message")),this.repeatCountElement.textContent=this.repeatCount},toString:function(){var e,s,t;switch(this.source){case WebInspector.ConsoleMessage.MessageSource.HTML:e="HTML";break;case WebInspector.ConsoleMessage.MessageSource.WML:e="WML";break;case WebInspector.ConsoleMessage.MessageSource.XML:e="XML";break;case WebInspector.ConsoleMessage.MessageSource.JS:e="JS";break;case WebInspector.ConsoleMessage.MessageSource.CSS:e="CSS";break;case WebInspector.ConsoleMessage.MessageSource.Other:e="Other"}switch(this.type){case WebInspector.ConsoleMessage.MessageType.Log:case WebInspector.ConsoleMessage.MessageType.UncaughtException:case WebInspector.ConsoleMessage.MessageType.NetworkError:s="Log";break;case WebInspector.ConsoleMessage.MessageType.Object:s="Object";break;case WebInspector.ConsoleMessage.MessageType.Trace:s="Trace";break;case WebInspector.ConsoleMessage.MessageType.StartGroupCollapsed:case WebInspector.ConsoleMessage.MessageType.StartGroup:s="Start Group";break;case WebInspector.ConsoleMessage.MessageType.EndGroup:s="End Group";break;case WebInspector.ConsoleMessage.MessageType.Assert:s="Assert";break;case WebInspector.ConsoleMessage.MessageType.Result:s="Result"}switch(this.level){case WebInspector.ConsoleMessage.MessageLevel.Tip:t="Tip";break;case WebInspector.ConsoleMessage.MessageLevel.Log:t="Log";break;case WebInspector.ConsoleMessage.MessageLevel.Warning:t="Warning";break;case WebInspector.ConsoleMessage.MessageLevel.Debug:t="Debug";break;case WebInspector.ConsoleMessage.MessageLevel.Error:t="Error"}return e+" "+s+" "+t+": "+this._formattedMessage.textContent+"\n"+this.url+" line "+this.line},isEqual:function(e){if(!e)return!1;if(this._stackTrace){if(!e._stackTrace)return!1;for(var s=this._stackTrace,t=e._stackTrace,o=0;o<s.length;o++)if(s[o].scriptName!==t[o].scriptName||s[o].functionName!==t[o].functionName||s[o].lineNumber!==t[o].lineNumber||s[o].column!==t[o].column)return!1}return this.source===e.source&&this.type===e.type&&this.level===e.level&&this.line===e.line&&this.url===e.url&&this.message===e.message&&this._requestId===e._requestId}},
// Note: Keep these constants in sync with the ones in Console.h
WebInspector.ConsoleMessage.MessageSource={HTML:0,WML:1,XML:2,JS:3,CSS:4,Other:5},WebInspector.ConsoleMessage.MessageType={Log:0,Object:1,Trace:2,StartGroup:3,StartGroupCollapsed:4,EndGroup:5,Assert:6,UncaughtException:7,NetworkError:8,Result:9},WebInspector.ConsoleMessage.MessageLevel={Tip:0,Log:1,Warning:2,Error:3,Debug:4},WebInspector.ConsoleCommand=function(e){this.command=e},WebInspector.ConsoleCommand.prototype={toMessageElement:function(){var e=document.createElement("div");e.command=this,e.className="console-user-command";var s=document.createElement("span");return s.className="console-message-text source-code",s.textContent=this.command,e.appendChild(s),e}},WebInspector.ConsoleCommandResult=function(e,s){var t=e.isError()?WebInspector.ConsoleMessage.MessageLevel.Error:WebInspector.ConsoleMessage.MessageLevel.Log;this.originatingCommand=s,WebInspector.ConsoleMessage.call(this,WebInspector.ConsoleMessage.MessageSource.JS,WebInspector.ConsoleMessage.MessageType.Result,t,-1,null,1,null,[e])},WebInspector.ConsoleCommandResult.prototype={toMessageElement:function(){var e=WebInspector.ConsoleMessage.prototype.toMessageElement.call(this);return e.addStyleClass("console-user-command-result"),e}},WebInspector.ConsoleCommandResult.prototype.__proto__=WebInspector.ConsoleMessage.prototype,WebInspector.ConsoleGroup=function(e){this.parentGroup=e;var s=document.createElement("div");s.className="console-group",(s.group=this).element=s;var t=document.createElement("div");t.className="console-group-messages",s.appendChild(t),this.messagesElement=t},WebInspector.ConsoleGroup.prototype={addMessage:function(e){var s=e.toMessageElement();if(e.type===WebInspector.ConsoleMessage.MessageType.StartGroup||e.type===WebInspector.ConsoleMessage.MessageType.StartGroupCollapsed){this.messagesElement.parentNode.insertBefore(s,this.messagesElement),s.addEventListener("click",this._titleClicked.bind(this),!1);var t=s.enclosingNodeOrSelfWithClass("console-group");t&&e.type===WebInspector.ConsoleMessage.MessageType.StartGroupCollapsed&&t.addStyleClass("collapsed")}else this.messagesElement.appendChild(s);s.previousSibling&&e.originatingCommand&&s.previousSibling.command===e.originatingCommand&&s.previousSibling.addStyleClass("console-adjacent-user-command-result")},_titleClicked:function(e){var s=e.target.enclosingNodeOrSelfWithClass("console-group-title");if(s){var t=s.enclosingNodeOrSelfWithClass("console-group");t&&(t.hasStyleClass("collapsed")?t.removeStyleClass("collapsed"):t.addStyleClass("collapsed")),s.scrollIntoViewIfNeeded(!0)}e.stopPropagation(),e.preventDefault()}};